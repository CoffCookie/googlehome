var fetch = require('isomorphic-fetch');
var host = 'https://translate.google.com';

/**
 * Get Key from https://translate.google.com
 *
 * @param   {Number!} timeout  default is 10000ms
 * @return  Promise(key: String)
 */
module.exports = function (timeout) {
  return fetch(host, {
    timeout: timeout || 10 * 1000
  })
  .then(function (res) {
    if (res.status !== 200) {
      throw new Error('request to ' + host + ' failed, status code = ' + res.status + ' (' + res.statusText + ')');
    }
    return res.text();
  })
  .then(function (html) {
    //var TKK = null;
    //
    var match = html.match("tkk:'(\\d+.\\d+)',"); //TKK = '436001.3073172371'
    //data:\d+.\d+
    //console.log(match[1]);
/*	
    var match = html.match("TKK='(\\d+.\\d+)';");
     try {
       eval(html.match(/TKK=eval\(\'\(.*\)\'\);/g)[0]);  // TKK = '405291.1334555331'
       if (TKK === null) throw null;
     } catch (e) {
       throw new Error('get key failed from google');
     }
*/	 
    if (!match) throw new Error('get key failed from google');

    //return TKK;
    return match[1];
  });
};
